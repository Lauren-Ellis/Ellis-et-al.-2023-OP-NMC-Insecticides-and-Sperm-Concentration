---
title: "Ellis et al., 2023 Meta-analysis R Code"
author: "Lauren Ellis"
date of last update: "September 20, 2023"
output: html_document
---

This R Markdown file presents the annotated R code for the statistical analysis underlying Ellis et al. (2023). Adult Organophosphate and Carbamate Insecticide Exposure and Sperm Concentration: A Systematic Review and Meta-Analysis of the Epidemiological Evidence.

# I. Set Up
## A. Load packages

```{r load packages}
library(tidyverse)
library(metafor)
library(clubSandwich)
library(dmetar)
library(readxl)
library(writexl)

setwd("~/Documents/Research")
```

## B. Check R and meta-analysis package versions

```{r meta-analysis package versions}
R.version
packageVersion('metafor')
packageVersion('clubSandwich')
packageVersion('dmetar')
```

R version as of date of last revision (9/20/2023):   

* R version 4.2.2 (2022-10-31) "Innocent and Trusting"    
* RStudio 2022.07.2+576 "Spotted Wakerobin" (from "About RStudio")    

Meta-analysis package versions as of date of submission (9/20/2023):   

* 'metafor' - V. ‘3.8.1’   
* 'clubSandwich' - V. ‘0.5.8’
* 'dmetar' - V. ‘0.0.9000’   

##  C. Load extracted results data
Note: Extracted results data can be downloaded on GitHub: https://github.com/Lauren-Ellis/Ellis-et-al.-2023-OP-NMC-Insecticides-and-Sperm-Concentration   

```{r import data}
OPNMC_data <- read_excel<- read_excel("~/Documents/Research/Ellis-et-al-2023-study-results-data-9.20.23.xlsx", 
              sheet = "Results Data")
OPNMC_data
```

# II. Data Preparation
## A. Effect size calculations and conversions
Process:        

1. Filter by "formula input" and create new data set for each type of input   
2. Mutate each data set to add a new variable (Cohen's d, standardized mean difference, SMD) using relevant conversion formulas        
3. Merge data sets with shared Cohen's d variable    
4. Compute bias-corrected Hedges' g from Cohen's d    

Notes on partial effect sizes:       

* This meta-analysis pooled unadjusted and partial effect sizes in the same analysis.   
* When calculating partial mean difference effect sizes from adjusted measures, it is recommended to use unadjusted group-level standard deviations (SDs) to calculate the pooled SD.   
    + If unadjusted SDs are unavailable, it is recommended to use a multiplier --- $sqrt(1-R^2)$ --- in an attempt to restore the unadjusted pooled SD (remove the effect of model fit).   
        - This concept is discussed in the context of ANCOVA models in [Borenstein & Hedges, 2019 (Chp. 11)](https://www.jstor.org/stable/10.7758/9781610448864) (p. 215-216) and is expanded for applications to linear regression models in [Aloe et al., 2022](https://www.tandfonline.com/doi/abs/10.1080/00220973.2021.1966605).  
    + In this meta-analysis:    
        - Unadjusted SDs were only available for two adjusted mean difference measures (Padungtod et al. (1999a; 2000) and Yucra et al. (2006)).  
        - Model R^2 values were not available for any adjusted mean difference measures.  
  
### 1. Mean difference data to Cohen's d   
#### a) Mean difference data

Notes:    

* Used methods from [Borenstein & Hedges, 2019 (Chp. 11)](https://www.jstor.org/stable/10.7758/9781610448864) to convert mean differences (md) into Cohen's d.    
* Unadjusted or adjusted mean differences between two independent groups (including adjusted mean differences from ANCOVA models and beta coefficients from multivariate regression models with a binary exposure variable and continuous outcome variable) and unadjusted or adjusted group-level standard deviations were accepted as inputs   
* Equations performed in Excel prior to import into R:    
    + Mean difference = mean_exposed - mean_control   
    + SD = SE * SQRT(N)   
    + See sheet 2 of the results data file for imputations and formulas used to back-transform log scale values to raw scale   

```{r MD to SMD}
# Create functions to transform mean difference to standardized mean difference (d)
md2smd <- function(md, sd.e, sd.c, n.e, n.c) {
  md / (sqrt((((n.e - 1) * (sd.e^2)) + ((n.c - 1) * (sd.c^2))) / (n.e + n.c - 2)))
  } # Borenstein & Hedges, 2019; p. 212, Eq. 11.15-11.16

missing_values <- is.na(OPNMC_data$SD_E)

md2smd_var <- function(n.e, n.c, smd) {
  ((n.e + n.c) / (n.e*n.c)) + ((smd^2) / (2*(n.e + n.c)))
  } # Borenstein & Hedges, 2019; p. 213, Eq. 11.17

# Apply functions and other calculations
OPNMC_Data_MD <- OPNMC_data %>%
  filter(Formula_Inputs == "MD-SDs") %>%  # includes unadjusted means, adjusted means, and beta-md coefficients
  mutate(
    SD_E = if_else(Study == "Tan (2005)", 
                   mean(SD_E, na.rm = TRUE),
    # calculate mean of study-reported group-level sample standard deviations and impute missing standard deviations for Tan (2005)
                   SD_E),
    SD_C = if_else(Study == "Tan (2005)", 
                   mean(SD_C, na.rm = TRUE),
                   SD_C),    
    Di = md2smd(md = MD, sd.e = SD_E, sd.c = SD_C, n.e = N_E, n.c = N_C), # convert mean difference and standard deviation data to standardized mean difference and variance
    D_Vi = md2smd_var(n.e = N_E, n.c = N_C, smd = Di)
  )
```
#### b) T-statistic

Notes:    

* Used methods from [Borenstein & Hedges, 2019 (Chp. 11)](https://www.jstor.org/stable/10.7758/9781610448864) to convert t-statistics into Cohen's d.     
* t-statistics from an unadjusted/adjusted t-test of differences in group means or multivariate regression models with a binary exposure variable and continuous outcome variable were accepted as inputs.   
* Equations performed in Excel prior to import into R:      
    + SE = (95%CI_upper - 95%CI_lower) / 3.92      
    + t-statistic = ABS(MD/SE)    
    + See sheet 2 of the results data file for imputations and formulas used to back-transform log scale values to raw scale

```{r T to SMD}
# Create functions to transform t-statistic to standardized mean difference (d)
tstat2smd <- function(t, n.e, n.c) {
  t * (sqrt((n.e + n.c) / (n.e*n.c)))
  }

tstat2smd_var <- function(n.e, n.c, smd) {
  (((n.e+n.c) / (n.e*n.c)) + ((smd^2) / (2*(n.e+n.c))))
  }

# Apply functions
OPNMC_Data_Tstat_Neg <- OPNMC_data %>%
  filter(Formula_Inputs == "MD-T") %>%
  filter(MD < 0) %>%
  mutate(
    Di = tstat2smd(t = (as.double(T_Stat)), n.e = N_E, n.c = N_C) * -1,  # multiplied by -1 to get correct direction of effect
    D_Vi = tstat2smd_var(n.e = N_E, n.c = N_C, smd = Di)
    )

OPNMC_Data_Tstat_Pos <- OPNMC_data %>%
  filter(Formula_Inputs == "MD-T") %>%
  filter(MD > 0) %>%
  mutate(
    Di = tstat2smd(t = (as.double(T_Stat)), n.e = N_E, n.c = N_C),
    D_Vi = tstat2smd_var(n.e = N_E, n.c = N_C, smd = Di)
  )

# Merge data
OPNMC_Data_Tstat <- full_join(OPNMC_Data_Tstat_Neg, OPNMC_Data_Tstat_Pos)
```

### 2. Odds ratio to Cohen's d  
Notes:    

* Used methods from [Borenstein & Hedges, 2019 (Chp. 11)](https://www.jstor.org/stable/10.7758/9781610448864) to convert odds ratios into Cohen's d.         
* Unadjusted or adjusted ORs (beta coefficient from logistic regression model) were accepted as inputs.   
* 'log' = natural log (ln) in base R    

```{r OR to SMD}
# Create functions
or2smd <- function(or) {
  ((log(or) * (sqrt(3))) / pi)
  } # Borenstein & Hedges, 2019; p. 233, Eq. 11.76

or2smd_var <- function(or.vln) {
 ((3 * or.vln) / (pi^2))
  } # Borenstein & Hedges, 2019; p. 232-233, Table 11.5 & 11.77

# Apply functions
OPNMC_Data_ORTable <- OPNMC_data %>%
  filter(Formula_Inputs == "OR") %>% # input is 2x2 table (1 study, Whorton 1979)
  mutate(
    OR = ((N_E_D * N_C_ND ) / (N_E_ND * N_C_D)), # calculate OR from 2x2 table narrative provided in Discussion of Whorton (1979); Borenstein & Hedges, 2019; p. 232-233, Table 11.5
    OR_Vln = ((1/N_E_D) + (1/N_E_ND) + (1/N_C_D) + (1/N_C_ND)), # calculate variance of ln(OR) from 2x2 table narrative provided in Discussion of Whorton (1979); Borenstein & Hedges, 2019; p. 232-233, Table 11.5
    Di = (or2smd(or = OR) * -1), # multiplied by -1 to get correct direction of effect
    D_Vi = ((3 * OR_Vln) / (pi^2))
  )

OPNMC_Data_BetaOR <- OPNMC_data %>%
  filter(Formula_Inputs == "Beta-OR") %>% # input is beta coefficient from multiple logistic regression model
  mutate(
    OR_Vln = ((log(OR_UB) - log(OR_LB)) / (2 * 1.96))^2, # formulas provided in Borenstein & Hedges (Table 11.15)
    Di = (or2smd(or = OR) * -1), # multiplied by -1 to get correct direction of effect
    D_Vi = or2smd_var(or.vln = OR_Vln)
  )

# Merge data
OPNMC_Data_OR <- full_join(OPNMC_Data_ORTable, OPNMC_Data_BetaOR)
```

### 3. Correlation/partial correlation to Cohen's d
#### a) Bivariate correlation

Note: Used methods from [Borenstein & Hedges, 2019 (Chp. 11)](https://www.jstor.org/stable/10.7758/9781610448864) to convert bivariate correlation coefficients to Cohen's d.    


```{r R to SMD}
# Create functions
r_var <- function(r, n){
  ((1-(r^2))^2) / (n-1)
} # Borenstein & Hedges, 2019; p. 220, Eq. 11.35

r2smd <- function(r) {
  (2 * r) / (sqrt(1-(r^2)))
} # Borenstein & Hedges, 2019; p. 234, Eq. 11.80

r2smd_var <- function(r, r.v) {
  (4 * r.v) / ((1-(r^2))^3)
} # Borenstein & Hedges, 2019; p. 234, Rq. 11.81

# Apply functions
OPNMC_Data_R <- OPNMC_data %>%
  filter(Formula_Inputs == "R") %>%
  mutate(
    R_Vi = as.double(r_var(r = R, n = N_Total)),
    Di = as.double(r2smd(r = R)),
    D_Vi = as.double(r2smd_var(r = R, r.v = R_Vi))
  )
```
#### b) T-statistic/partial correlation
**Adjusted beta-cont (t-stat) to partial correlation to Cohen's d**    

Notes:  

* Used methods from [Aloe et al., 2013](https://www.journals.uchicago.edu/doi/abs/10.5243/jsswr.2013.24) to calculate a partial correlation from homogenized multivariate linear regression beta coefficients 
    + 't' is the statistic of the regression coefficient (study-reported or homogenized by review team) in the multiple regression model   
    + 'df' is the degrees of freedom    
    + 'p' is the number predictors included in the model, including the exposure variable of interest   
    + 'n' is the number of study participants   
    
* Equations performed in Excel prior to import into R:   
    + SE = (95%CI_upper - 95%CI_lower) / 3.92   
    + t-statistic = ABS(beta/SE) or t-statistic = inv.t(p-value, df), where df = n (total) - p (no. of predictors) - 1     
    
* See sheet 2 of the results data file for imputations and formulas used to back-transform log scale values to raw scale   

```{r partial R to SMD}
# Create functions
betaconttstat2partialr <- function(t, N_Total, p) {
  t / ((sqrt((t^2)) + (N_Total - p - 1)))
} # Aloe et al., 2013; p. 392, Eq. 2

betaconttstat2partialr_var <- function(r.partial, N_Total, p) {
  ((1 - (r.partial^2))^2) / (N_Total - p - 1)
} # Aloe et al., 2013; p. 392, Eq. 3

# Apply functions 
OPNMC_Data_BetaContTstat_Neg <- OPNMC_data %>%
  filter(Formula_Inputs == "Beta-Cont-T") %>%
  filter(BetaCont < 0) %>%
  mutate(
    T_stat = as.double(T_Stat),
    Partial_Ri = as.double(betaconttstat2partialr(t = T_stat, N_Total = N_Total, p = No_Predictors)),
    Partial_R_Vi = as.double(betaconttstat2partialr_var(r.partial = Partial_Ri, N_Total = N_Total, 
                                              p = No_Predictors)),
    Di = (2 * Partial_Ri) / (sqrt(1-(Partial_Ri^2))) * -1,  # multiplied by -1 to get correct direction of effect
    D_Vi = (4 * Partial_R_Vi) / ((1-(Partial_Ri^2))^3)
    )

OPNMC_Data_BetaContTstat_Pos <- OPNMC_data %>%
  filter(Formula_Inputs == "Beta-Cont-T") %>%
  filter(BetaCont >= 0) %>%
  mutate(
    T_stat = as.double(T_Stat),
    Partial_Ri = as.double(betaconttstat2partialr(t = T_stat, N_Total = N_Total, p = No_Predictors)),
    Partial_R_Vi = as.double(betaconttstat2partialr_var(r.partial = Partial_Ri, N_Total = N_Total, 
                                              p = No_Predictors)),
    Di = (2 * Partial_Ri) / (sqrt(1-(Partial_Ri^2))),
    D_Vi = (4 * Partial_R_Vi) / ((1-(Partial_Ri^2))^3)
  )

# Merge data
OPNMC_Data_BetaContTstat <- full_join(OPNMC_Data_BetaContTstat_Neg, OPNMC_Data_BetaContTstat_Pos)
```

### 4. Convert Cohen's d to Hedges' g   
Notes:  

* Hedges' g refers to the bias-corrected Cohen's d, or standardized mean difference   
* Correction factor (J) from [Aloe et al., 2022](https://www.tandfonline.com/doi/abs/10.1080/00220973.2021.1966605):   
  + p = number of predictors included in model    
  + If bivariate, p = 1, if multivariate, p > 1      
 
```{r merge and hedges g}
# Merge Cohens' d data
OPNMC_Data1 <- full_join(OPNMC_Data_MD, OPNMC_Data_Tstat)
OPNMC_Data2 <- full_join(OPNMC_Data1, OPNMC_Data_OR)
OPNMC_Data3 <- full_join(OPNMC_Data2, OPNMC_Data_R)
OPNMC_Data4 <- full_join(OPNMC_Data3, OPNMC_Data_BetaContTstat)

# Create functions
smd2hedgesG <- function(smd, N_Total, p) {
  smd * (1 - (3 / (4 * (N_Total - p - 1) - 1)))
  } # Aloe et al., 2021

smd2hedgesG_var <- function(smd.var, N_Total, p) {
  smd.var * ((1 - (3 / ((4 * (N_Total - p - 1)) - 1)))^2)
  } # Aloe et al., 2021

# Apply functions
OPNMC_Data_HedgesG <- OPNMC_Data4 %>%
  mutate(
    Gi = smd2hedgesG(smd = Di, N_Total = N_Total, p = No_Predictors),
    G_Vi = smd2hedgesG_var(smd.var = D_Vi, N_Total = N_Total, p = No_Predictors)
  )

OPNMC_Data_HedgesG
```

# III. Descriptive Statistics
## A. Distribution of effect sizes

```{r}
# Histogram of effect sizes
histo1 <- ggplot(OPNMC_Data_HedgesG, aes(x = Gi)) +
            geom_histogram(aes(y = after_stat(count)), colour = "black", fill="white")
histo1

# Summary data on study-level effect sizes
OPNMCdatadistro <- OPNMC_Data_HedgesG %>%
  summarise(
    N_studies = length(unique(Study_ID)),
    N_studypops = length(unique(StudyPop_ID)),
    N_effects = length(unique(ES_ID)),
    Gi_Mean = mean(Gi),
    Gi_SD = sd(Gi),
    Gi_Median = median(Gi),
    Gi_Q1 = quantile(Gi, 0.25),
    Gi_Q3 = quantile(Gi, 0.75),
    Gi_Min = min(Gi),
    Gi_Max = max(Gi),
  )
OPNMCdatadistro

# Summary data on study-level effect sizes, by exposure setting
OPNMCdatadistro_expsetting <- OPNMC_Data_HedgesG %>%
  group_by(Exposure_Setting) %>%
  summarize(
    N_effects = length(unique(ES_ID)),
    pct = round((N_effects / nrow(OPNMC_Data_HedgesG) * 100)),
    Gi_Mean = mean(Gi),
    Gi_SD = sd(Gi),
    Gi_Mean = mean(Gi),
    Gi_SD = sd(Gi),
    Gi_Median = median(Gi),
    Gi_Q1 = quantile(Gi, 0.25),
    Gi_Q3 = quantile(Gi, 0.75),
    Gi_Min = min(Gi),
    Gi_Max = max(Gi)
  )
OPNMCdatadistro_expsetting
```

## B. Number of unique men included

```{r}
# No. of effect size estimates and men by study population
OPNMCdatadistro_SampleID <- OPNMC_Data_HedgesG %>%
  group_by(StudyPop_ID) %>%
  summarise(
    N_effects = length(unique(ES_ID)),
    N_men = max(N_Total)
  )
OPNMCdatadistro_SampleID

Total_Men_Included <- sum(OPNMCdatadistro_SampleID$N_men) # 1,774 unique male participants
```

1,774 unique men were included in the primary meta-analysis based on the sum of the maximum amount of men included in the meta-analysis from each unique study population.   

# IV. Meta-Analysis
## A. Exploring model fit
### 1. Two vs. three levels of random effect
There are two types of dependencies present in the data:   

* Correlation dependencies because some effect sizes originate from overlapping study participants and therefore have correlated sampling errors.    
    + A correlation of 0.8 was assumed between dependent effect sizes, or effect sizes from the same study populations, unless otherwise noted.   
* Hierarchical dependencies because some effect sizes are nested under the same study populations.  
    + To explore model fit, we tested whether a three-level model fit the data better than a two-level model    
        - The general structure when creating levels of random effect using rma.mv looks like this: ~ 1 | cluster/effects_within_cluster.     
    + Levels of random effect:     
        - Level 1 = variation in sampling error   
        - Level 2 = variation in effect sizes within each cluster (study population)   
        - Level 3 = variation between clusters (study populations)   

```{r}
# 2 vs 3 level w/ correlational dependencies
OPNMC_Vmatrix_0.8 <- impute_covariance_matrix(vi = OPNMC_Data_HedgesG$G_Vi,
                                             cluster = OPNMC_Data_HedgesG$StudyPop_ID,
                                             r = 0.8)

OPNMC_MLMA_2levels <- rma.mv(yi = Gi,
                            V = OPNMC_Vmatrix_0.8,
                            data = OPNMC_Data_HedgesG,
                            random = ~ 1 | ES_ID,
                            digits = 2)

OPNMC_MLMA_3levels <- rma.mv(yi = Gi,
                           V = OPNMC_Vmatrix_0.8,
                           data = OPNMC_Data_HedgesG,
                           random = ~ 1 | StudyPop_ID/ES_ID,
                           digits = 2)

anova(OPNMC_MLMA_2levels, OPNMC_MLMA_3levels)
```

### 2. Profile likelihood plots for 3-level
Note: When fitting complex, multilevel meta-analytic models, it is important to verify the identifiability of the variance components of the model. (Citation: https://www.metafor-project.org/doku.php/analyses:konstantopoulos2011)

```{r}
par(mfrow=c(2,1))
profile(OPNMC_MLMA_3levels, sigma2=1)
profile(OPNMC_MLMA_3levels, sigma2=2)
```

Because the peaks of the plot correspond to the estimates of the given value(s) given by the model, we can be confident that both levels of random effect (within-study and between-study heterogeneity components) are identifiable.

## B. Primary meta-analysis
Note: The "coef_test" function from clubSandwich calculates robust standard errors and robust t-tests for the beta coefficient or the meta-analysis model, also called the pooled effect estimate.

### 1. Overall pooled Hedges' g (G_pooled)

```{r}
# Calculate variance-covariance matrix
OPNMC_Vmatrix_0.8 <- impute_covariance_matrix(vi = OPNMC_Data_HedgesG$G_Vi,
                                             cluster = OPNMC_Data_HedgesG$StudyPop_ID,
                                             r = 0.8)
# Run MA
OPNMC_MLMA <- rma.mv(yi = Gi,
                         V = OPNMC_Vmatrix_0.8,
                         data = OPNMC_Data_HedgesG,
                         random = ~ 1 | StudyPop_ID/ES_ID,
                         digits = 2)

# Calculate robust SEs/CIs
OPNMC_MLMA_robust_SE <- coef_test(OPNMC_MLMA, vcov = "CR2", digits = 2)
OPNMC_MLMA_robust_CI <- conf_int(OPNMC_MLMA, vcov = "CR2", digits = 2)
OPNMC_MLMA_robust <- full_join(OPNMC_MLMA_robust_SE,
                              OPNMC_MLMA_robust_CI)

# Calculate I^2 parameters
I2estimates_OPNMC <- var.comp(x = OPNMC_MLMA)

# Calculate CIs for Tao^2 estimates
OPNMC_MLMA_Tao2CI <- confint(OPNMC_MLMA)

# Calculate prediction interval
OPNMC_MLMA_PI <- predict(OPNMC_MLMA)

# Print weights
OPNMC_MLMA_Weights <- weights(OPNMC_MLMA)
```

### 2. Publication bias

```{r}
# Run MA model testing the impact of study precision (defined as the inverse of the total sample size) on effect size
(OPNMC_MLMA_PubBias_EggerTest_N <- rma.mv(yi = Gi,
                                         V = OPNMC_Vmatrix_0.8, 
                                         data = OPNMC_Data_HedgesG,
                                         random = ~ 1 | StudyPop_ID/ES_ID,
                                         mod = (1/(sqrt(N_Total))),
                                         digits = 2))
# Calculate robust SEs/CIs
OPNMC_MLMA_PubBias_EggerTest_N_robust <- coef_test(OPNMC_MLMA_PubBias_EggerTest_N, vcov = "CR2", digits = 2)
OPNMC_MLMA_PubBias_EggerTest_N_robust
```

Based on the results of the cluster-robust Egger's regression test for small study effects, study precision is an insignificant predictor of effect size. While there is no statistical sign of publication bias, the test had limited statistical power (df_Satt < 4).

## C. Secondary meta-analyses
### 1. Data sensitivity analyses
#### a) Outlier/influential effects   

Note: Removed outlier and influential studies separately:    

* Used Tukey's Fences method to identify outlier effects     
* Used Cook's Distance to identify influential effects    

```{r}
# Identify outlier effects via Tukey's fences method
Q1 <- quantile(OPNMC_Data_HedgesG$Gi)[2]
Q3 <- quantile(OPNMC_Data_HedgesG$Gi)[4]
IQR <- IQR(OPNMC_Data_HedgesG$Gi)
outlier.threshold.lower = Q1 - (IQR * 1.5)
outlier.threshold.upper = Q3 + (IQR * 1.5)
LowerOutliers <- OPNMC_Data_HedgesG$ES_ID[OPNMC_Data_HedgesG$Gi < outlier.threshold.lower] # ES_IDs 4, 5, 19
UpperOutliers <- OPNMC_Data_HedgesG$ES_ID[OPNMC_Data_HedgesG$Gi > outlier.threshold.upper] # None

# Run MA without outliers
OPNMC_MLMA_NoOutliers <- rma.mv(yi = Gi,
                               V = OPNMC_Vmatrix_0.8, 
                               data = OPNMC_Data_HedgesG,
                               random = ~ 1 | StudyPop_ID/ES_ID,
                               digits = 2,
                               subset = (ES_ID != 4 & ES_ID != 5 & ES_ID != 19))

OPNMC_MLMA_NoOutliers_robustSE <- coef_test(OPNMC_MLMA_NoOutliers, vcov = "CR2")
OPNMC_MLMA_NoOutliers_robustCI <- conf_int(OPNMC_MLMA_NoOutliers, vcov = "CR2")
OPNMC_MLMA_NoOutliers_robust <- full_join(OPNMC_MLMA_NoOutliers_robustSE,
                                          OPNMC_MLMA_NoOutliers_robustCI)

# Identify influential effects via Cook's distance
CooksD_ES <- cooks.distance(OPNMC_MLMA)
plot(CooksD_ES, type="o", pch=19, xlab="Observed Outcome", ylab="Cook's Distance")
InfluentialES <- CooksD_ES[(CooksD_ES > (3 * mean(CooksD_ES, na.rm = TRUE)))] # ES_IDs 2 and 3

# Run MA without influential effects
OPNMC_MLMA_NoInfluentials <- rma.mv(yi = Gi,
                               V = OPNMC_Vmatrix_0.8, 
                               data = OPNMC_Data_HedgesG,
                               random = ~ 1 | StudyPop_ID/ES_ID,
                               digits = 2,
                               subset = (ES_ID != 2 & ES_ID != 3))
                               
OPNMC_MLMA_NoInfluentials_robustSE <- coef_test(OPNMC_MLMA_NoInfluentials, vcov = "CR2")
OPNMC_MLMA_NoInfluentials_robustCI <- conf_int(OPNMC_MLMA_NoInfluentials, vcov = "CR2")
OPNMC_MLMA_NoInfluentials_robust <- full_join(OPNMC_MLMA_NoInfluentials_robustSE,
                                            OPNMC_MLMA_NoInfluentials_robustCI)

# Calculate I2 stats
I2estimates_NoOutliers <- var.comp(OPNMC_MLMA_NoOutliers)
I2estimates_NoInfluentials <- var.comp(OPNMC_MLMA_NoInfluentials)

# Summary table
OPNMC_MLMA_OutlierInfl_Results <- data.frame(
   Category = c("Primary", "No-Outlier-Effects", "No-Influential-Effects"),
   N_StudyPops = round(c(OPNMC_MLMA$s.nlevels[1], OPNMC_MLMA_NoOutliers$s.nlevels[1],
                         OPNMC_MLMA_NoInfluentials$s.nlevels[1]), digits = 2),
   N_Effects = round(c(OPNMC_MLMA$s.nlevels[2], OPNMC_MLMA_NoOutliers$s.nlevels[2],
                       OPNMC_MLMA_NoInfluentials$s.nlevels[2]), digits = 2),
   Estimate = round(c(OPNMC_MLMA$b, OPNMC_MLMA_NoOutliers$b,
                      OPNMC_MLMA_NoInfluentials$b), digits = 2),
   Robust_SE = round(c(OPNMC_MLMA_robust$SE, OPNMC_MLMA_NoOutliers_robust$SE,
                       OPNMC_MLMA_NoInfluentials_robust$SE), digits = 2),
   Robust_CIL = round(c(OPNMC_MLMA_robust$CI_L, OPNMC_MLMA_NoOutliers_robust$CI_L,
                        OPNMC_MLMA_NoInfluentials_robust$CI_L), digits = 2),
   Robust_CIU = round(c(OPNMC_MLMA_robust$CI_U, OPNMC_MLMA_NoOutliers_robust$CI_U,
                        OPNMC_MLMA_NoInfluentials_robust$CI_U), digits = 2),
   df_Satt = round(c(OPNMC_MLMA_robust$df, OPNMC_MLMA_NoOutliers_robust$df,
                     OPNMC_MLMA_NoInfluentials_robust$df), digits = 2),
   p_Satt = round(c(OPNMC_MLMA_robust$p_Satt, OPNMC_MLMA_NoOutliers_robust$p_Satt,
                    OPNMC_MLMA_NoInfluentials_robust$p_Satt), digits = 2),
   BtwStudyPop_T2 = round(c(OPNMC_MLMA$sigma2[1], OPNMC_MLMA_NoOutliers$sigma2[1],
                            OPNMC_MLMA_NoInfluentials$sigma2[1]), digits = 2),
   BtwStudyPop_I2 = round(c(I2estimates_OPNMC$results$`% of total variance`[3],
                            I2estimates_NoOutliers$results$`% of total variance`[3],
                            I2estimates_NoInfluentials$results$`% of total variance`[3]), digits = 2),
   WinStudyPop_T2 = round(c(OPNMC_MLMA$sigma2[2], OPNMC_MLMA_NoOutliers$sigma2[2],
                            OPNMC_MLMA_NoInfluentials$sigma2[2]), digits = 2),
   WinStudyPop_I2 = round(c(I2estimates_OPNMC$results$`% of total variance`[2],
                            I2estimates_NoOutliers$results$`% of total variance`[2],
                            I2estimates_NoInfluentials$results$`% of total variance`[2]), digits = 2),
   p_Heterog = round(c(OPNMC_MLMA$QEp, OPNMC_MLMA_NoOutliers$QEp,
                       OPNMC_MLMA_NoInfluentials$QEp), digits = 2))

OPNMC_MLMA_OutlierInfl_Results
```

#### b) Correlation between dependent effect sizes

Note: Ran meta-analyses for the full range of r (correlation between effect sizes originating from all or some of the same men) options to examine the impact of potential misspecification of the assumed correlation between dependent effect sizes used to construct a variance-covariance matrix.

```{r}
# r = 0
V_matrix_0 <- impute_covariance_matrix(vi = OPNMC_Data_HedgesG$G_Vi, cluster = OPNMC_Data_HedgesG$StudyPop_ID, r = 0)

OPNMC_MLMA_0 <- rma.mv(yi = Gi,
                      V = V_matrix_0,
                      data = OPNMC_Data_HedgesG,
                      random = ~ 1 | StudyPop_ID/ES_ID,
                      digits = 2)

OPNMC_MLMA_0_club_robustSE <- coef_test(OPNMC_MLMA_0, vcov = "CR2", digits = 2)
OPNMC_MLMA_0_club_robustCI <- conf_int(OPNMC_MLMA_0, vcov = "CR2", digits = 2)
OPNMC_MLMA_0_robust <- full_join(OPNMC_MLMA_0_club_robustSE, OPNMC_MLMA_0_club_robustCI)

# r = 0.2
V_matrix_0.2 <- impute_covariance_matrix(vi = OPNMC_Data_HedgesG$G_Vi,
                                      cluster = OPNMC_Data_HedgesG$StudyPop_ID,
                                      r = 0.2)
OPNMC_MLMA_0.2 <- rma.mv(yi = Gi,
                         V = V_matrix_0.2,
                         data = OPNMC_Data_HedgesG,
                         random = ~ 1 | StudyPop_ID/ES_ID)

OPNMC_MLMA_0.2_club_robustSE <- coef_test(OPNMC_MLMA_0.2, vcov = "CR2", digits = 2)
OPNMC_MLMA_0.2_club_robustCI <- conf_int(OPNMC_MLMA_0.2, vcov = "CR2", digits = 2)
OPNMC_MLMA_0.2_robust <- full_join(OPNMC_MLMA_0.2_club_robustSE, OPNMC_MLMA_0.2_club_robustCI)

# r = 0.4
V_matrix_0.4 <- impute_covariance_matrix(vi = OPNMC_Data_HedgesG$G_Vi,
                                      cluster = OPNMC_Data_HedgesG$StudyPop_ID,
                                      r = 0.4)
OPNMC_MLMA_0.4 <- rma.mv(yi = Gi,
                           V = V_matrix_0.4,
                           data = OPNMC_Data_HedgesG,
                           random = ~ 1 | StudyPop_ID/ES_ID)

OPNMC_MLMA_0.4_club_robustSE <- coef_test(OPNMC_MLMA_0.4, vcov = "CR2", digits = 2)
OPNMC_MLMA_0.4_club_robustCI <- conf_int(OPNMC_MLMA_0.4, vcov = "CR2", digits = 2)
OPNMC_MLMA_0.4_robust <- full_join(OPNMC_MLMA_0.4_club_robustSE, OPNMC_MLMA_0.4_club_robustCI)

# r = 0.6
V_matrix_0.6 <- impute_covariance_matrix(vi = OPNMC_Data_HedgesG$G_Vi,
                                      cluster = OPNMC_Data_HedgesG$StudyPop_ID,
                                      r = 0.6)
OPNMC_MLMA_0.6 <- rma.mv(yi = Gi,
                           V = V_matrix_0.6,
                           data = OPNMC_Data_HedgesG,
                           random = ~ 1 | StudyPop_ID/ES_ID)


OPNMC_MLMA_0.6_club_robustSE <- coef_test(OPNMC_MLMA_0.6, vcov = "CR2", digits = 2)
OPNMC_MLMA_0.6_club_robustCI <- conf_int(OPNMC_MLMA_0.6, vcov = "CR2", digits = 2)
OPNMC_MLMA_0.6_robust <- full_join(OPNMC_MLMA_0.6_club_robustSE, OPNMC_MLMA_0.6_club_robustCI)

# r = 0.8
V_matrix_0.8 <- impute_covariance_matrix(vi = OPNMC_Data_HedgesG$G_Vi,
                                        cluster = OPNMC_Data_HedgesG$StudyPop_ID,
                                        r = 0.8)

OPNMC_MLMA_0.8 <- rma.mv(yi = Gi,
                           V = V_matrix_0.8,
                           data = OPNMC_Data_HedgesG,
                           random = ~ 1 | StudyPop_ID/ES_ID,
                           digits = 3)

OPNMC_MLMA_0.8_club_robustSE <- coef_test(OPNMC_MLMA_0.8, vcov = "CR2", digits = 2)
OPNMC_MLMA_0.8_club_robustCI <- conf_int(OPNMC_MLMA_0.8, vcov = "CR2", digits = 2)
OPNMC_MLMA_0.8_robust <- full_join(OPNMC_MLMA_0.8_club_robustSE, OPNMC_MLMA_0.8_club_robustCI)

# r = 0.9
V_matrix_0.9 <- impute_covariance_matrix(vi = OPNMC_Data_HedgesG$G_Vi,
                                        cluster = OPNMC_Data_HedgesG$StudyPop_ID,
                                        r = 0.9)

OPNMC_MLMA_0.9 <- rma.mv(yi = Gi,
                           V = V_matrix_0.9,
                           data = OPNMC_Data_HedgesG,
                           random = ~ 1 | StudyPop_ID/ES_ID,
                           digits = 3)

OPNMC_MLMA_0.9_club_robustSE <- coef_test(OPNMC_MLMA_0.9, vcov = "CR2", digits = 2)
OPNMC_MLMA_0.9_club_robustCI <- conf_int(OPNMC_MLMA_0.9, vcov = "CR2", digits = 2)
OPNMC_MLMA_0.9_robust <- full_join(OPNMC_MLMA_0.9_club_robustSE, OPNMC_MLMA_0.9_club_robustCI)

# r = 0.95
V_matrix_0.95 <- impute_covariance_matrix(vi = OPNMC_Data_HedgesG$G_Vi,
                                      cluster = OPNMC_Data_HedgesG$StudyPop_ID,
                                      r = 0.95)

OPNMC_MLMA_0.95 <- rma.mv(yi = Gi,
                         V = V_matrix_0.95,
                         data = OPNMC_Data_HedgesG,
                         random = ~ 1 | StudyPop_ID/ES_ID,
                         digits = 3)

OPNMC_MLMA_0.95_club_robustSE <- coef_test(OPNMC_MLMA_0.95, vcov = "CR2", digits = 2)
OPNMC_MLMA_0.95_club_robustCI <- conf_int(OPNMC_MLMA_0.95, vcov = "CR2", digits = 2)
OPNMC_MLMA_0.95_robust <- full_join(OPNMC_MLMA_0.95_club_robustSE, OPNMC_MLMA_0.95_club_robustCI)

# Calculate I2 stats
I2estimates_0 <- var.comp(x = OPNMC_MLMA_0)
I2estimates_0.2 <- var.comp(x = OPNMC_MLMA_0.2)
I2estimates_0.4 <- var.comp(x = OPNMC_MLMA_0.4)
I2estimates_0.6 <- var.comp(x = OPNMC_MLMA_0.6)
I2estimates_0.8 <- var.comp(x = OPNMC_MLMA_0.8)
I2estimates_0.9 <- var.comp(x = OPNMC_MLMA_0.9)
I2estimates_0.95 <- var.comp(x = OPNMC_MLMA_0.95)

# Summary table
RhoChoiceSA_ResultsTable = data.frame(
    Rho_choice = c(0, 0.2, 0.4, 0.6, 0.8, 0.9, 0.95),
    N_StudyPops = round(c(OPNMC_MLMA_0$s.nlevels[1], OPNMC_MLMA_0.2$s.nlevels[1],OPNMC_MLMA_0.4$s.nlevels[1],
                        OPNMC_MLMA_0.6$s.nlevels[1], OPNMC_MLMA_0.8$s.nlevels[1],OPNMC_MLMA_0.9$s.nlevels[1],
                        OPNMC_MLMA_0.95$s.nlevels[1]), digits = 2),
    N_Effects = round(c(OPNMC_MLMA_0$s.nlevels[2], OPNMC_MLMA_0.2$s.nlevels[2],OPNMC_MLMA_0.4$s.nlevels[2],
                        OPNMC_MLMA_0.6$s.nlevels[2], OPNMC_MLMA_0.8$s.nlevels[2],OPNMC_MLMA_0.9$s.nlevels[2],
                        OPNMC_MLMA_0.95$s.nlevels[2]), digits = 2),
    Estimate = round(c(OPNMC_MLMA_0$b, OPNMC_MLMA_0.2$b,OPNMC_MLMA_0.4$b,
                        OPNMC_MLMA_0.6$b, OPNMC_MLMA_0.8$b,OPNMC_MLMA_0.9$b,
                        OPNMC_MLMA_0.95$b), digits = 2),
    Robsut_SE = round(c(OPNMC_MLMA_0_robust$SE, OPNMC_MLMA_0.2_robust$SE,OPNMC_MLMA_0.4_robust$SE,
                        OPNMC_MLMA_0.6_robust$SE, OPNMC_MLMA_0.8_robust$SE,OPNMC_MLMA_0.9_robust$SE,
                        OPNMC_MLMA_0.95_robust$SE), digits = 2),
    Robust_CIL = round(c(OPNMC_MLMA_0_robust$CI_L, OPNMC_MLMA_0.2_robust$CI_L, OPNMC_MLMA_0.4_robust$CI_L,
                        OPNMC_MLMA_0.6_robust$CI_L, OPNMC_MLMA_0.8_robust$CI_L, OPNMC_MLMA_0.9_robust$CI_L,
                        OPNMC_MLMA_0.95_robust$CI_L), digits = 2),
    Robust_CIU = round(c(OPNMC_MLMA_0_robust$CI_U, OPNMC_MLMA_0.2_robust$CI_U, OPNMC_MLMA_0.4_robust$CI_U,
                        OPNMC_MLMA_0.6_robust$CI_U, OPNMC_MLMA_0.8_robust$CI_U, OPNMC_MLMA_0.9_robust$CI_U,
                        OPNMC_MLMA_0.95_robust$CI_U), digits = 2),
    df_Satt = round(c(OPNMC_MLMA_0_robust$df, OPNMC_MLMA_0.2_robust$df, OPNMC_MLMA_0.4_robust$df,
                        OPNMC_MLMA_0.6_robust$df, OPNMC_MLMA_0.8_robust$df, OPNMC_MLMA_0.9_robust$df,
                        OPNMC_MLMA_0.95_robust$df), digits = 2),
    p_Satt = round(c(OPNMC_MLMA_0_robust$p_Satt, OPNMC_MLMA_0.2_robust$p_Satt, OPNMC_MLMA_0.4_robust$p_Satt,
                        OPNMC_MLMA_0.6_robust$p_Satt, OPNMC_MLMA_0.8_robust$p_Satt, OPNMC_MLMA_0.9_robust$p_Satt,
                        OPNMC_MLMA_0.95_robust$p_Satt), digits = 2),
    BtwStudyPop_T2 = round(c(OPNMC_MLMA_0$sigma2[1], OPNMC_MLMA_0.2$sigma2[1], OPNMC_MLMA_0.4$sigma2[1], 
                            OPNMC_MLMA_0.6$sigma2[1], OPNMC_MLMA_0.8$sigma2[1], OPNMC_MLMA_0.9$sigma2[1],
                            OPNMC_MLMA_0.95$sigma2[1]), digits = 2),
    BtwStudyPop_I2 = round(c(I2estimates_0$results$`% of total variance`[3], I2estimates_0.2$results$`% of total variance`[3], 
                          I2estimates_0.4$results$`% of total variance`[3], I2estimates_0.6$results$`% of total variance`[3],
                          I2estimates_0.8$results$`% of total variance`[3], I2estimates_0.9$results$`% of total variance`[3],
                          I2estimates_0.95$results$`% of total variance`[3]), 
                        digits = 2),
    WinStudyPop_T2 = round(c(OPNMC_MLMA_0$sigma2[2], OPNMC_MLMA_0.2$sigma2[2], OPNMC_MLMA_0.4$sigma2[2], 
                            OPNMC_MLMA_0.6$sigma2[2], OPNMC_MLMA_0.8$sigma2[2], OPNMC_MLMA_0.9$sigma2[2],
                            OPNMC_MLMA_0.95$sigma2[2]), digits = 2),
    WinStudyPop_I2 = round(c(I2estimates_0$results$`% of total variance`[2], I2estimates_0.2$results$`% of total variance`[2], 
                          I2estimates_0.4$results$`% of total variance`[2], I2estimates_0.6$results$`% of total variance`[2],
                          I2estimates_0.8$results$`% of total variance`[2], I2estimates_0.9$results$`% of total variance`[2],
                          I2estimates_0.95$results$`% of total variance`[2]), digits = 2),
    p_Heterog = round(c(OPNMC_MLMA_0$QEp, OPNMC_MLMA_0.2$QEp,OPNMC_MLMA_0.4$QEp,
                        OPNMC_MLMA_0.6$QEp, OPNMC_MLMA_0.8$QEp,OPNMC_MLMA_0.9$QEp,
                        OPNMC_MLMA_0.95$QEp), digits = 2))

RhoChoiceSA_ResultsTable
```

#### c) Heterogeneity estimate (confidence interval) 

Note: Ran meta-analyses using the lower and upper bounds of the Q-profile around REML heterogeneity point estimates for each level of random effect.

```{r}
# Calculate CI around Tao2 estimates of primary meta-analysis
OPNMC_MLMA_Tao2CI <- confint(OPNMC_MLMA)

# Fix sigma values at lower bound of CI
OPNMC_MLMA_Tao2CILB <- rma.mv(yi = Gi,
                              V = OPNMC_Vmatrix_0.8,
                              data = OPNMC_Data_HedgesG,
                              random = ~ 1 | StudyPop_ID/ES_ID,
                              sigma2 = c(0.01, 0.01),
                              digits = 2)

OPNMC_MLMA_Tao2CILB_robustSE <- coef_test(OPNMC_MLMA_Tao2CILB, vcov = "CR2", digits = 2)
OPNMC_MLMA_Tao2CILB_robustCI <- conf_int(OPNMC_MLMA_Tao2CILB, vcov = "CR2", digits = 2)
OPNMC_MLMA_Tao2CILB_robust <- full_join(OPNMC_MLMA_Tao2CILB_robustSE,  OPNMC_MLMA_Tao2CILB_robustCI)

# Fix sigma values at upper bound of CI
OPNMC_MLMA_Tao2CIUB <- rma.mv(yi = Gi,
                                    V = V_matrix_0.8,
                                    data = OPNMC_Data_HedgesG,
                                    random = ~ 1 | StudyPop_ID/ES_ID,
                                    sigma2 = c(0.28, 0.07),
                                    digits = 2)

OPNMC_MLMA_Tao2CIUB_robustSE <- coef_test(OPNMC_MLMA_Tao2CIUB, vcov = "CR2", digits = 2)
OPNMC_MLMA_Tao2CIUB_robustCI <- conf_int(OPNMC_MLMA_Tao2CIUB, vcov = "CR2", digits = 2)
OPNMC_MLMA_Tao2CIUB_robust <- full_join(OPNMC_MLMA_Tao2CIUB_robustSE, OPNMC_MLMA_Tao2CIUB_robustCI)

# Calculate I^2 parameters
I2estimates_0.8_Tao2CILB <- var.comp(OPNMC_MLMA_Tao2CILB)
I2estimates_0.8_Tao2CIUB <- var.comp(OPNMC_MLMA_Tao2CIUB)

# Summary table
OPNMC_MLMA_Tao2CISA_Summary <- data.frame(
   Tao2_EstimateType = c("Point Estimate", " Lower Bound", "Upper Bound"),
   N_StudyPops = round(c(OPNMC_MLMA$s.nlevels[1], OPNMC_MLMA_Tao2CILB$s.nlevels[1], 
                         OPNMC_MLMA_Tao2CIUB$s.nlevels[1]), digits = 2),
   N_Effects = round(c(OPNMC_MLMA$s.nlevels[2], OPNMC_MLMA_Tao2CILB$s.nlevels[2], 
                          OPNMC_MLMA_Tao2CIUB$s.nlevels[2]), digits = 2),
   Estimate = round(c(OPNMC_MLMA$b, OPNMC_MLMA_Tao2CILB$b, 
                          OPNMC_MLMA_Tao2CIUB$b), digits = 2),
   Robust_SE = round(c(OPNMC_MLMA_robust$SE, OPNMC_MLMA_Tao2CILB_robust$SE, 
                          OPNMC_MLMA_Tao2CIUB_robust$SE), digits = 2),
   Robust_CIL = round(c(OPNMC_MLMA_robust$CI_L, OPNMC_MLMA_Tao2CILB_robust$CI_L, 
                          OPNMC_MLMA_Tao2CIUB_robust$CI_L), digits = 2),
   Robust_CIU = round(c(OPNMC_MLMA_robust$CI_U, OPNMC_MLMA_Tao2CILB_robust$CI_U, 
                          OPNMC_MLMA_Tao2CIUB_robust$CI_U), digits = 2),
   df_Satt = round(c(OPNMC_MLMA_robust$df, OPNMC_MLMA_Tao2CILB_robust$df, 
                          OPNMC_MLMA_Tao2CIUB_robust$df), digits = 2),
   p_Satt = round(c(OPNMC_MLMA_robust$p_Satt, OPNMC_MLMA_Tao2CILB_robust$p_Satt, 
                          OPNMC_MLMA_Tao2CIUB_robust$p_Satt), digits = 2),
   BtwStudyPop_T2 = round(c(OPNMC_MLMA$sigma2[1], OPNMC_MLMA_Tao2CILB$sigma2[1], 
                            OPNMC_MLMA_Tao2CIUB$sigma2[1]), digits = 2),
   BtwStudyPop_I2 = round(c(I2estimates_0.8$results$`% of total variance`[3],
                           I2estimates_0.8_Tao2CILB$results$`% of total variance`[3],
                           I2estimates_0.8_Tao2CIUB$results$`% of total variance`[3]), digits = 2),
   WinStudyPop_T2 = round(c(OPNMC_MLMA$sigma2[2], OPNMC_MLMA_Tao2CILB$sigma2[2], 
                            OPNMC_MLMA_Tao2CIUB$sigma2[2]), digits = 2),
   WinStudyPop_I2 = round(c(I2estimates_0.8$results$`% of total variance`[2],
                           I2estimates_0.8_Tao2CILB$results$`% of total variance`[2],
                           I2estimates_0.8_Tao2CIUB$results$`% of total variance`[2]), digits = 2),
   p_Heterog = round(c(OPNMC_MLMA$QEp, OPNMC_MLMA_Tao2CILB$QEp, 
                          OPNMC_MLMA_Tao2CIUB$QEp), digits = 2))

OPNMC_MLMA_Tao2CISA_Summary
```

#### d) Data manipulations (imputations, log to raw scale, and effect size transformations)
Three types of data manipulation sensitivity analyses were performed:   

* SA_Imputation: Removed effect sizes calculated with one or more data imputation   
    + Melgarejo et al., 2015    
    + Perry et al., 2007    
    + Tan et al., 2005    
* SA_Log: Removed effect sizes that were back transformed from log to raw scale      
    + Melgarejo et al., 2015    
    + Perry et al., 2007    
    + Swan et al., 2003   
    + Tan et al., 2005    
* SA_Transform: Removed effect sizes that were transformed to standardized mean difference index    
    + Manikandan et al., 2021      
    + Meeker et al., 2004   
    + Melgarejo et al., 2015        
    + Perez-Herrera et al., 2008        
    + Perry et al., 2011      
    + Swan et al., 2003     
    + Whorton et al., 1979   
    
See sheet 2 of the results data file for imputations and formulas used to back-transform log scale values to raw scale   
  
```{r}
# SA_Imputation
OPNMC_MLMA_SA1 <- rma.mv(yi = Gi,
                           V = V_matrix_0.8,
                           data = OPNMC_Data_HedgesG,
                           random = ~ 1 | StudyPop_ID/ES_ID,
                           subset = (OPNMC_Data_HedgesG$SA_Imputation == 0))

OPNMC_MLMA_SA1_robustSE <- coef_test(OPNMC_MLMA_SA1, vcov = "CR2", digits = 2)
OPNMC_MLMA_SA1_robustCI <- conf_int(OPNMC_MLMA_SA1, vcov = "CR2", digits = 2)
OPNMC_MLMA_SA1_robust <- full_join(OPNMC_MLMA_SA1_robustSE, OPNMC_MLMA_SA1_robustCI)

# SA_Log
OPNMC_MLMA_SA2 <- rma.mv(yi = Gi,
                           V = V_matrix_0.8,
                           data = OPNMC_Data_HedgesG,
                           random = ~ 1 | StudyPop_ID/ES_ID,
                           subset = (OPNMC_Data_HedgesG$SA_Log == 0))

OPNMC_MLMA_SA2_robustSE <- coef_test(OPNMC_MLMA_SA2, vcov = "CR2", digits = 2)
OPNMC_MLMA_SA2_robustCI <- conf_int(OPNMC_MLMA_SA2, vcov = "CR2", digits = 2)
OPNMC_MLMA_SA2_robust <- full_join(OPNMC_MLMA_SA2_robustSE, OPNMC_MLMA_SA2_robustCI)

# SA_Transform
OPNMC_MLMA_SA3 <- rma.mv(yi = Gi,
                           V = V_matrix_0.8,
                           data = OPNMC_Data_HedgesG,
                           random = ~ 1 | StudyPop_ID/ES_ID,
                           subset = (OPNMC_Data_HedgesG$SA_Transform == 0))

OPNMC_MLMA_SA3_robustSE <- coef_test(OPNMC_MLMA_SA3, vcov = "CR2", digits = 2)
OPNMC_MLMA_SA3_robustCI <- conf_int(OPNMC_MLMA_SA3, vcov = "CR2", digits = 2)
OPNMC_MLMA_SA3_robust <- full_join(OPNMC_MLMA_SA3_robustSE, OPNMC_MLMA_SA3_robustCI)

# Calculate I^2 parameters
I2estimates_SA1 <- var.comp(x = OPNMC_MLMA_SA1)
I2estimates_SA2 <- var.comp(x = OPNMC_MLMA_SA2)
I2estimates_SA3 <- var.comp(x = OPNMC_MLMA_SA3)

# Summary table
OPNMC_MLMA_DataManipSA_ResultsTable <- data.frame(
   SA_Status = c("SA1","SA2", "SA3"),
   N_StudyPops = round(c(OPNMC_MLMA_SA1$s.nlevels[1], OPNMC_MLMA_SA2$s.nlevels[1], 
                         OPNMC_MLMA_SA3$s.nlevels[1]), digits = 2),
   N_Effects = round(c(OPNMC_MLMA_SA1$s.nlevels[2], OPNMC_MLMA_SA2$s.nlevels[2],
                       OPNMC_MLMA_SA3$s.nlevels[2]), digits = 2),
   Estimate = round(c(OPNMC_MLMA_SA1$b, OPNMC_MLMA_SA2$b, 
                          OPNMC_MLMA_SA3$b), digits = 2),
   Robust_SE = round(c(OPNMC_MLMA_SA1_robust$SE, OPNMC_MLMA_SA2_robust$SE, 
                          OPNMC_MLMA_SA3_robust$SE), digits = 2),
   Robust_CIL = round(c(OPNMC_MLMA_SA1_robust$CI_L, OPNMC_MLMA_SA2_robust$CI_L, 
                          OPNMC_MLMA_SA3_robust$CI_L), digits = 2),
   Robust_CIU = round(c(OPNMC_MLMA_SA1_robust$CI_U, OPNMC_MLMA_SA2_robust$CI_U, 
                          OPNMC_MLMA_SA3_robust$CI_U), digits = 2),
   df_Satt = round(c(OPNMC_MLMA_SA1_robust$df, OPNMC_MLMA_SA2_robust$df, 
                          OPNMC_MLMA_SA3_robust$df), digits = 2),
   p_Satt = round(c(OPNMC_MLMA_SA1_robust$p_Satt, OPNMC_MLMA_SA2_robust$p_Satt, 
                          OPNMC_MLMA_SA3_robust$p_Satt), digits = 2),
   BtwStudyPop_T2 = round(c(OPNMC_MLMA_SA1$sigma2[1], OPNMC_MLMA_SA2$sigma2[1], 
                            OPNMC_MLMA_SA3$sigma2[1]), digits = 2),
   BtwStudyPop_I2 = round(c(I2estimates_SA1$results$`% of total variance`[3], 
                          I2estimates_SA2$results$`% of total variance`[3], 
                          I2estimates_SA3$results$`% of total variance`[3]), digits = 2),
   WinStudyPop_T2 = round(c(OPNMC_MLMA_SA1$sigma2[2], OPNMC_MLMA_SA2$sigma2[2], 
                            OPNMC_MLMA_SA3$sigma2[2]), digits = 2),
   WinStudyPop_I2 = round(c(I2estimates_SA1$results$`% of total variance`[2], 
                          I2estimates_SA2$results$`% of total variance`[2], 
                          I2estimates_SA3$results$`% of total variance`[2]), digits = 2),
   p_Heterog = round(c(OPNMC_MLMA_SA1$QEp, OPNMC_MLMA_SA2$QEp, 
                          OPNMC_MLMA_SA3$QEp), digits = 2))

OPNMC_MLMA_DataManipSA_ResultsTable
```

### 2. Moderator sensitivity analyses
#### a) Risk of Bias    

Note: Removed studies with high or probably high risk of bias in each domain of bias.

```{r}
# Blinding bias
OPNMC_MLMA_BlindLow <- rma.mv(yi = Gi,
                             V = OPNMC_Vmatrix_0.8, 
                             data = OPNMC_Data_HedgesG,
                             random = ~ 1 | StudyPop_ID/ES_ID,
                             subset = (B_Bias == "Low" | 
                               B_Bias == "P_Low"))

OPNMC_MLMA_BlindLow_robustSE <- coef_test(OPNMC_MLMA_BlindLow, vcov = "CR2")
OPNMC_MLMA_BlindLow_robustCI <- conf_int(OPNMC_MLMA_BlindLow, vcov = "CR2")
OPNMC_MLMA_BlindLow_robust <- full_join(OPNMC_MLMA_BlindLow_robustSE,
                                       OPNMC_MLMA_BlindLow_robustCI)


# Recruitment bias
OPNMC_MLMA_RecruitLow <- rma.mv(yi = Gi,
                               V = OPNMC_Vmatrix_0.8, 
                               data = OPNMC_Data_HedgesG,
                               random = ~ 1 | StudyPop_ID/ES_ID,
                               subset = (R_Bias == "Low" | 
                                         R_Bias == "P_Low"))

OPNMC_MLMA_RecruitLow_robustSE <- coef_test(OPNMC_MLMA_RecruitLow, vcov = "CR2")
OPNMC_MLMA_RecruitLow_robustCI <- conf_int(OPNMC_MLMA_RecruitLow, vcov = "CR2")
OPNMC_MLMA_RecruitLow_robust <- full_join(OPNMC_MLMA_RecruitLow_robustSE,
                                         OPNMC_MLMA_RecruitLow_robustCI)


# Exposure assessment bias
OPNMC_MLMA_ExpLow <- rma.mv(yi = Gi,
                           V = OPNMC_Vmatrix_0.8, 
                           data = OPNMC_Data_HedgesG,
                           random = ~ 1 | StudyPop_ID/ES_ID,
                           subset = (E_Bias == "P_Low" | 
                                       E_Bias == "Low"))

OPNMC_MLMA_ExpLow_robustSE <- coef_test(OPNMC_MLMA_ExpLow, vcov = "CR2")
OPNMC_MLMA_ExpLow_robustCI <- conf_int(OPNMC_MLMA_ExpLow, vcov = "CR2")
OPNMC_MLMA_ExpLow_robust <- full_join(OPNMC_MLMA_ExpLow_robustSE,
                                     OPNMC_MLMA_ExpLow_robustCI)

# Confounding bias
OPNMC_MLMA_ConfLow <- rma.mv(yi = Gi,
                            V = OPNMC_Vmatrix_0.8, 
                            data = OPNMC_Data_HedgesG,
                            random = ~ 1 | StudyPop_ID/ES_ID,
                            subset = (C_Bias == "Low"))

OPNMC_MLMA_ConfLow_robustSE <- coef_test(OPNMC_MLMA_ConfLow, vcov = "CR2")
OPNMC_MLMA_ConfLow_robustCI <- conf_int(OPNMC_MLMA_ConfLow, vcov = "CR2")
OPNMC_MLMA_ConfLow_robust <- full_join(OPNMC_MLMA_ConfLow_robustSE,
                                      OPNMC_MLMA_ConfLow_robustCI)

# Outcome bias
OPNMC_MLMA_OutLow <- rma.mv(yi = Gi,
                               V = OPNMC_Vmatrix_0.8, 
                               data = OPNMC_Data_HedgesG,
                               random = ~ 1 | StudyPop_ID/ES_ID,
                               subset = (O_Bias == "Low" | 
                                         O_Bias == "P_Low"))

OPNMC_MLMA_OutLow_robustSE <- coef_test(OPNMC_MLMA_OutLow, vcov = "CR2")
OPNMC_MLMA_OutLow_robustCI <- conf_int(OPNMC_MLMA_OutLow, vcov = "CR2")
OPNMC_MLMA_OutLow_robust <- full_join(OPNMC_MLMA_OutLow_robustSE,
                                    OPNMC_MLMA_OutLow_robustCI)

# SOR bias
OPNMC_MLMA_SORLow <- rma.mv(yi = Gi,
                               V = OPNMC_Vmatrix_0.8, 
                               data = OPNMC_Data_HedgesG,
                               random = ~ 1 | StudyPop_ID/ES_ID,
                               subset = (SOR_Bias == "Low" | 
                                         SOR_Bias == "P_Low"))

OPNMC_MLMA_SORLow_robustSE <- coef_test(OPNMC_MLMA_SORLow, vcov = "CR2")
OPNMC_MLMA_SORLow_robustCI <- conf_int(OPNMC_MLMA_SORLow, vcov = "CR2")
OPNMC_MLMA_SORLow_robust <- full_join(OPNMC_MLMA_SORLow_robustSE,
                                    OPNMC_MLMA_SORLow_robustCI)


# COI bias
OPNMC_MLMA_COILow <- rma.mv(yi = Gi,
                             V = OPNMC_Vmatrix_0.8, 
                             data = OPNMC_Data_HedgesG,
                             random = ~ 1 | StudyPop_ID/ES_ID,
                             subset = (COI_Bias == "Low" | 
                                       COI_Bias == "P_Low"))

OPNMC_MLMA_COILow_robustSE <- coef_test(OPNMC_MLMA_COILow, vcov = "CR2")
OPNMC_MLMA_COILow_robustCI <- conf_int(OPNMC_MLMA_COILow, vcov = "CR2")
OPNMC_MLMA_COILow_robust <- full_join(OPNMC_MLMA_COILow_robustSE,
                                     OPNMC_MLMA_COILow_robustCI)


# Calculate I2 stats
I2estimates_BlindLow <- var.comp(OPNMC_MLMA_BlindLow)
I2estimates_RecruitLow <- var.comp(OPNMC_MLMA_RecruitLow)
I2estimates_ExpLow <- var.comp(OPNMC_MLMA_ExpLow)
I2estimates_ConfLow <- var.comp(OPNMC_MLMA_ConfLow)
I2estimates_OutLow <- var.comp(OPNMC_MLMA_OutLow)
I2estimates_SORLow <- var.comp(OPNMC_MLMA_SORLow)
I2estimates_COILow <- var.comp(OPNMC_MLMA_COILow)

# Summary table 
OPNMCData_RiskofBias_ResultsTable <- data.frame(
  Category = c("Total", "Blind-Low", "Recruit-Low", "Exp-Low", "Conf-Low", "Outcome-Low","SOR-Low", "COI-Low"),
  No_StudyPops = (round(c(OPNMC_MLMA$s.nlevels[1], OPNMC_MLMA_BlindLow$s.nlevels[1],
                        OPNMC_MLMA_RecruitLow$s.nlevels[1], OPNMC_MLMA_ExpLow$s.nlevels[1],
                        OPNMC_MLMA_ConfLow$s.nlevels[1],
                        OPNMC_MLMA_OutLow$s.nlevels[1],
                        OPNMC_MLMA_SORLow$s.nlevels[1],
                        OPNMC_MLMA_COILow$s.nlevels[1]), digits = 2)),
  No_Effects = (round(c(OPNMC_MLMA$s.nlevels[2], OPNMC_MLMA_BlindLow$s.nlevels[2],
                        OPNMC_MLMA_RecruitLow$s.nlevels[2], OPNMC_MLMA_ExpLow$s.nlevels[2],
                        OPNMC_MLMA_ConfLow$s.nlevels[2],
                        OPNMC_MLMA_OutLow$s.nlevels[2],
                        OPNMC_MLMA_SORLow$s.nlevels[2],
                        OPNMC_MLMA_COILow$s.nlevels[2]), digits = 2)),
  Estimate = (round(c(OPNMC_MLMA$b, OPNMC_MLMA_BlindLow$b,
                      OPNMC_MLMA_RecruitLow$b, OPNMC_MLMA_ExpLow$b,
                      OPNMC_MLMA_ConfLow$b,
                      OPNMC_MLMA_OutLow$b,
                      OPNMC_MLMA_SORLow$b,
                      OPNMC_MLMA_COILow$b), digits = 2)),
  Robust_SE = (round(c(OPNMC_MLMA_robust$SE, OPNMC_MLMA_BlindLow_robust$SE,
                      OPNMC_MLMA_RecruitLow_robust$SE, OPNMC_MLMA_ExpLow_robust$SE,
                      OPNMC_MLMA_ConfLow_robust$SE,
                      OPNMC_MLMA_OutLow_robust$SE,
                      OPNMC_MLMA_SORLow_robust$SE,
                      OPNMC_MLMA_COILow_robust$SE), digits = 2)),
  Robust_CIL = (round(c(OPNMC_MLMA_robust$CI_L, OPNMC_MLMA_BlindLow_robust$CI_L,
                         OPNMC_MLMA_RecruitLow_robust$CI_L, OPNMC_MLMA_ExpLow_robust$CI_L,
                         OPNMC_MLMA_ConfLow_robust$CI_L,
                         OPNMC_MLMA_OutLow_robust$CI_L,
                         OPNMC_MLMA_SORLow_robust$CI_L,
                         OPNMC_MLMA_COILow_robust$CI_L), digits = 2)),
  Robust_CIU = (round(c(OPNMC_MLMA_robust$CI_U, OPNMC_MLMA_BlindLow_robust$CI_U,
                         OPNMC_MLMA_RecruitLow_robust$CI_U, OPNMC_MLMA_ExpLow_robust$CI_U,
                         OPNMC_MLMA_ConfLow_robust$CI_U,
                         OPNMC_MLMA_OutLow_robust$CI_U,
                         OPNMC_MLMA_SORLow_robust$CI_U,
                         OPNMC_MLMA_COILow_robust$CI_U), digits = 2)),
  df_Satt = (round(c(OPNMC_MLMA_robust$df, OPNMC_MLMA_BlindLow_robust$df,
                       OPNMC_MLMA_RecruitLow_robust$df, OPNMC_MLMA_ExpLow_robust$df,
                       OPNMC_MLMA_ConfLow_robust$df,
                       OPNMC_MLMA_OutLow_robust$df,
                       OPNMC_MLMA_SORLow_robust$df,
                       OPNMC_MLMA_COILow_robust$df), digits = 2)),
  p_Satt = (round(c(OPNMC_MLMA_robust$p_Satt, OPNMC_MLMA_BlindLow_robust$p_Satt,
                    OPNMC_MLMA_RecruitLow_robust$p_Satt, OPNMC_MLMA_ExpLow_robust$p_Satt,
                    OPNMC_MLMA_ConfLow_robust$p_Satt,
                    OPNMC_MLMA_OutLow_robust$p_Satt,
                    OPNMC_MLMA_SORLow_robust$p_Satt,
                    OPNMC_MLMA_COILow_robust$p_Satt), digits = 2)),
  BtwStudyPop_T2 = (round(c(OPNMC_MLMA$sigma2[1], OPNMC_MLMA_BlindLow$sigma2[1],
                        OPNMC_MLMA_RecruitLow$sigma2[1], OPNMC_MLMA_ExpLow$sigma2[1],
                        OPNMC_MLMA_ConfLow$sigma2[1],
                        OPNMC_MLMA_OutLow$sigma2[1],
                        OPNMC_MLMA_SORLow$sigma2[1],
                        OPNMC_MLMA_COILow$sigma2[1]), digits = 2)),
  BtwStudyPop_I2 = (round(c(I2estimates_OPNMC$results$`% of total variance`[3],
                        I2estimates_BlindLow$results$`% of total variance`[3],
                        I2estimates_RecruitLow$results$`% of total variance`[3],
                        I2estimates_ExpLow$results$`% of total variance`[3],
                        I2estimates_ConfLow$results$`% of total variance`[3],
                        I2estimates_OutLow$results$`% of total variance`[3],
                        I2estimates_SORLow$results$`% of total variance`[3],
                        I2estimates_COILow$results$`% of total variance`[3]), 
                      digits = 2)),
  WinStudyPop_T2 = (round(c(OPNMC_MLMA$sigma2[2], OPNMC_MLMA_BlindLow$sigma2[2],
                        OPNMC_MLMA_RecruitLow$sigma2[2], OPNMC_MLMA_ExpLow$sigma2[1],
                        OPNMC_MLMA_ConfLow$sigma2[2],
                        OPNMC_MLMA_OutLow$sigma2[2],
                        OPNMC_MLMA_SORLow$sigma2[2],
                        OPNMC_MLMA_COILow$sigma2[2]), digits = 2)),    
  WinStudyPop_I2 = (round(c(I2estimates_OPNMC$results$`% of total variance`[2],
                        I2estimates_BlindLow$results$`% of total variance`[2],
                        I2estimates_RecruitLow$results$`% of total variance`[2],
                        I2estimates_ExpLow$results$`% of total variance`[2],
                        I2estimates_ConfLow$results$`% of total variance`[2],
                        I2estimates_OutLow$results$`% of total variance`[2],
                        I2estimates_SORLow$results$`% of total variance`[2],
                        I2estimates_COILow$results$`% of total variance`[2]),
                      digits = 2)),
  P_Heterog = (round(c(OPNMC_MLMA$QEp, OPNMC_MLMA_BlindLow$QEp,
                       OPNMC_MLMA_RecruitLow$QEp, OPNMC_MLMA_ExpLow$QEp,
                       OPNMC_MLMA_ConfLow$QEp,
                       OPNMC_MLMA_OutLow$QEp,
                       OPNMC_MLMA_SORLow$QEp,
                       OPNMC_MLMA_COILow$QEp), digits = 2)))

OPNMCData_RiskofBias_ResultsTable
```

#### b) Other Moderators: Co-Exposures, Abstinence Time, and Medical Risk Factors

Note: Removed studies that did not control for co-exposures, abstinence time, and medical risk factors.

```{r}
# Known or measured co-exposures
OPNMC_MLMA_NoCoExp <- rma.mv(yi = Gi,
                             V = OPNMC_Vmatrix_0.8, 
                             data = OPNMC_Data_HedgesG,
                             random = ~ 1 | StudyPop_ID/ES_ID,
                             subset = (CoExp_Present != 1))

OPNMC_MLMA_NoCoExp_robustSE <- coef_test(OPNMC_MLMA_NoCoExp, vcov = "CR2", digits = 2)
OPNMC_MLMA_NoCoExp_robustCI <- conf_int(OPNMC_MLMA_NoCoExp, vcov = "CR2", digits = 2)
OPNMC_MLMA_NoCoExp_robust <- full_join(OPNMC_MLMA_NoCoExp_robustSE,
                                      OPNMC_MLMA_NoCoExp_robustCI)

# Abstinence time
OPNMC_MLMA_AbsTime <- rma.mv(yi = Gi,
                            V = OPNMC_Vmatrix_0.8, 
                            data = OPNMC_Data_HedgesG,
                            random = ~ 1 | StudyPop_ID/ES_ID,
                            digits = 2, 
                            subset = (AbsTime_Controlled == 1))

OPNMC_MLMA_AbsTime_robustSE <- coef_test(OPNMC_MLMA_AbsTime, vcov = "CR2")
OPNMC_MLMA_AbsTime_robustCI <- conf_int(OPNMC_MLMA_AbsTime, vcov = "CR2")
OPNMC_MLMA_AbsTime_robust <- full_join(OPNMC_MLMA_AbsTime_robustSE,
                                         OPNMC_MLMA_AbsTime_robustCI)

# Medical risk factors
OPNMC_MLMA_MedRiskFactors <- rma.mv(yi = Gi,
                                    V = OPNMC_Vmatrix_0.8, 
                                    data = OPNMC_Data_HedgesG,
                                    random = ~ 1 | StudyPop_ID/ES_ID,
                                    digits = 2,
                                    subset = (MedRiskFactor_Controlled == 1))

OPNMC_MLMA_MedRiskFactors_robustSE <- coef_test(OPNMC_MLMA_MedRiskFactors, vcov = "CR2")
OPNMC_MLMA_MedRiskFactors_robustCI <- conf_int(OPNMC_MLMA_MedRiskFactors, vcov = "CR2")
OPNMC_MLMA_MedRiskFactors_robust <- full_join(OPNMC_MLMA_MedRiskFactors_robustSE,
                                         OPNMC_MLMA_MedRiskFactors_robustCI)

# Calculate I2 stats
I2estimates_NoCoExp <- var.comp(OPNMC_MLMA_NoCoExp)
I2estimates_AbsTime <- var.comp(OPNMC_MLMA_AbsTime)
I2estimates_MedRiskFactors <- var.comp(OPNMC_MLMA_MedRiskFactors)

# Summary table
OPNMCData_ModAnalysis_ResultsTable <- data.frame(
    Category = c("Total", "Rmv-Co-exp", "AbsTime-Controlled", "MedRiskFactor-Controlled"),
    No_StudyPops = (round(c(OPNMC_MLMA$s.nlevels[1], OPNMC_MLMA_NoCoExp$s.nlevels[1],
                          OPNMC_MLMA_AbsTime$s.nlevels[1], OPNMC_MLMA_MedRiskFactors$s.nlevels[1]), digits = 2)),
    No_Effects = (round(c(OPNMC_MLMA$s.nlevels[2], OPNMC_MLMA_NoCoExp$s.nlevels[2],
                      OPNMC_MLMA_AbsTime$s.nlevels[2], OPNMC_MLMA_MedRiskFactors$s.nlevels[2]), digits = 2)),
    Estimate = (round(c(OPNMC_MLMA$b, OPNMC_MLMA_NoCoExp$b, 
                        OPNMC_MLMA_AbsTime$b, OPNMC_MLMA_MedRiskFactors$b), digits = 2)),
    Robust_SE = (round(c(OPNMC_MLMA_robust$SE, 
                        OPNMC_MLMA_NoCoExp_robust$SE,
                        OPNMC_MLMA_AbsTime_robust$SE, 
                        OPNMC_MLMA_MedRiskFactors_robust$SE), digits = 2)),
    Robust_CIL = (round(c(OPNMC_MLMA_robust$CI_L,
                           OPNMC_MLMA_NoCoExp_robust$CI_L, 
                           OPNMC_MLMA_AbsTime_robust$CI_L,
                           OPNMC_MLMA_MedRiskFactors_robust$CI_L), digits = 2)),
    Robust_CIU = (round(c(OPNMC_MLMA_robust$CI_U,
                           OPNMC_MLMA_NoCoExp_robust$CI_U,
                           OPNMC_MLMA_AbsTime_robust$CI_U, 
                           OPNMC_MLMA_MedRiskFactors_robust$CI_U), digits = 2)),
    df_Satt = (round(c(OPNMC_MLMA_robust$df,
                         OPNMC_MLMA_NoCoExp_robust$df,
                         OPNMC_MLMA_AbsTime_robust$df, 
                         OPNMC_MLMA_MedRiskFactors_robust$df), digits = 2)),
    p_Satt = (round(c(OPNMC_MLMA_robust$p_Satt,
                      OPNMC_MLMA_NoCoExp_robust$p_Satt,
                      OPNMC_MLMA_AbsTime_robust$p_Satt, 
                      OPNMC_MLMA_MedRiskFactors_robust$p_Satt), digits = 2)),
    BtwStudyPop_T2 = (round(c(OPNMC_MLMA$sigma2[1], OPNMC_MLMA_NoCoExp$sigma2[1],
                          OPNMC_MLMA_AbsTime$sigma2[1], OPNMC_MLMA_MedRiskFactors$sigma2[1]), digits = 2)),
    BtwStudyPop_I2 = (round(c(I2estimates_OPNMC$results$`% of total variance`[3],
                          I2estimates_NoCoExp$results$`% of total variance`[3],
                          I2estimates_AbsTime$results$`% of total variance`[3],
                          I2estimates_MedRiskFactors$results$`% of total variance`[3]), 
                        digits = 2)),
    WinStudyPop_T2 = (round(c(OPNMC_MLMA$sigma2[2], OPNMC_MLMA_NoCoExp$sigma2[2],
                          OPNMC_MLMA_AbsTime$sigma2[2], OPNMC_MLMA_MedRiskFactors$sigma2[2]), digits = 2)),
    WinStudyPop_I2 = (round(c(I2estimates_OPNMC$results$`% of total variance`[2],
                          I2estimates_NoCoExp$results$`% of total variance`[2],
                          I2estimates_AbsTime$results$`% of total variance`[2],
                          I2estimates_MedRiskFactors$results$`% of total variance`[2]), 
                        digits = 2)),
    P_Heterog = (round(c(OPNMC_MLMA$QEp, OPNMC_MLMA_NoCoExp$QEp, 
                         OPNMC_MLMA_AbsTime$QEp, OPNMC_MLMA_MedRiskFactors$QEp), digits = 2))
  )

OPNMCData_ModAnalysis_ResultsTable
```

### 3. Moderator subgroup analyses: insecticide class, expoure setting, and recruitment setting   

Note: Ran separate meta-analyses for each subgroup.   

```{r}
### OP/NMC Insecticide Class ###
# Studies that examined exposure only to OPs
OPNMC_MLMA_OP_Isolated <- rma.mv(yi = Gi,
                                 V = OPNMC_Vmatrix_0.8, 
                                 data = OPNMC_Data_HedgesG,
                                 random = ~ 1 | StudyPop_ID/ES_ID,
                                 subset = (Insecticide_Class == "OP"))

OPNMC_MLMA_OP_Isolated_robustSE <- coef_test(OPNMC_MLMA_OP_Isolated, vcov = "CR2", digits = 2)
OPNMC_MLMA_OP_Isolated_robustCI <- conf_int(OPNMC_MLMA_OP_Isolated, vcov = "CR2", digits = 2)
OPNMC_MLMA_OP_Isolated_robust <- full_join(OPNMC_MLMA_OP_Isolated_robustSE,
                                           OPNMC_MLMA_OP_Isolated_robustCI)

# Studies that examined exposure only to NMCs
OPNMC_MLMA_NMC_Isolated <- rma.mv(yi = Gi,
                                  V = OPNMC_Vmatrix_0.8, 
                                  data = OPNMC_Data_HedgesG,
                                  random = ~ 1 | StudyPop_ID/ES_ID,
                                  subset = (Insecticide_Class == "NMC"))

OPNMC_MLMA_NMC_Isolated_robustSE <- coef_test(OPNMC_MLMA_NMC_Isolated, vcov = "CR2", digits = 2)
OPNMC_MLMA_NMC_Isolated_robustCI <- conf_int(OPNMC_MLMA_NMC_Isolated, vcov = "CR2", digits = 2)
OPNMC_MLMA_NMC_Isolated_robust <- full_join(OPNMC_MLMA_NMC_Isolated_robustSE,
                                            OPNMC_MLMA_NMC_Isolated_robustCI)


# Studies that examined exposures to OP and/or NMCs
OPNMC_MLMA_OPandorNMC <- rma.mv(yi = Gi,
                                V = OPNMC_Vmatrix_0.8, 
                                data = OPNMC_Data_HedgesG,
                                random = ~ 1 | StudyPop_ID/ES_ID,
                                subset = (Insecticide_Class == "OP/NMC"))

OPNMC_MLMA_OPandorNMC_robustSE <- coef_test(OPNMC_MLMA_OPandorNMC, vcov = "CR2", digits = 2)
OPNMC_MLMA_OPandorNMC_robustCI <- conf_int(OPNMC_MLMA_OPandorNMC, vcov = "CR2", digits = 2)
OPNMC_MLMA_OPandorNMC_robust <- full_join(OPNMC_MLMA_OPandorNMC_robustSE,
                                          OPNMC_MLMA_OPandorNMC_robustCI)


### Recruitment Setting ###
# Population
OPNMC_MLMA_Pop <- rma.mv(yi = Gi,
                         V = OPNMC_Vmatrix_0.8, 
                         data = OPNMC_Data_HedgesG,
                         random = ~ 1 | StudyPop_ID/ES_ID,
                         subset = (Recruitment_Setting == "Population"))

OPNMC_MLMA_Pop_robustSE <- coef_test(OPNMC_MLMA_Pop, vcov = "CR2")
OPNMC_MLMA_Pop_robustCI <- conf_int(OPNMC_MLMA_Pop, vcov = "CR2")
OPNMC_MLMA_Pop_robust <- full_join(OPNMC_MLMA_Pop_robustSE,
                                   OPNMC_MLMA_Pop_robustCI)

# Clinic
OPNMC_MLMA_Clinic <- rma.mv(yi = Gi,
                            V = OPNMC_Vmatrix_0.8, 
                            data = OPNMC_Data_HedgesG,
                            random = ~ 1 | StudyPop_ID/ES_ID,
                            subset = (Recruitment_Setting == "Clinic"))

OPNMC_MLMA_Clinic_robustSE <- coef_test(OPNMC_MLMA_Clinic, vcov = "CR2")
OPNMC_MLMA_Clinic_robustCI <- conf_int(OPNMC_MLMA_Clinic, vcov = "CR2")
OPNMC_MLMA_Clinic_robust <- full_join(OPNMC_MLMA_Clinic_robustSE,
                                      OPNMC_MLMA_Clinic_robustCI)

### Exposure Setting ###
# Env
OPNMC_MLMA_Env <- rma.mv(yi = Gi,
                         V = OPNMC_Vmatrix_0.8, 
                         data = OPNMC_Data_HedgesG,
                         random = ~ 1 | StudyPop_ID/ES_ID,
                         subset = (Exposure_Setting == "Environmental"))

OPNMC_MLMA_Env_robustSE <- coef_test(OPNMC_MLMA_Env, vcov = "CR2")
OPNMC_MLMA_Env_robustCI <- conf_int(OPNMC_MLMA_Env, vcov = "CR2")
OPNMC_MLMA_Env_robust <- full_join(OPNMC_MLMA_Env_robustSE,
                                   OPNMC_MLMA_Env_robustCI)

# Occup
OPNMC_MLMA_Occup <- rma.mv(yi = Gi,
                           V = OPNMC_Vmatrix_0.8, 
                           data = OPNMC_Data_HedgesG,
                           random = ~ 1 | StudyPop_ID/ES_ID,
                           subset = (Exposure_Setting == "Occupational"))

OPNMC_MLMA_Occup_robustSE <- coef_test(OPNMC_MLMA_Occup, vcov = "CR2")
OPNMC_MLMA_Occup_robustCI <- conf_int(OPNMC_MLMA_Occup, vcov = "CR2")
OPNMC_MLMA_Occup_robust <- full_join(OPNMC_MLMA_Occup_robustSE,
                                     OPNMC_MLMA_Occup_robustCI)

### Calculate I2 stats ###
I2estimates_OP_Isolated <- var.comp(x = OPNMC_MLMA_OP_Isolated)
I2estimates_NMC_Isolated <- var.comp(x = OPNMC_MLMA_NMC_Isolated)
I2estimates_OPandorNMC <- var.comp(x = OPNMC_MLMA_OPandorNMC)
I2estimates_Pop <- var.comp(OPNMC_MLMA_Pop)
I2estimates_Clinic <- var.comp(OPNMC_MLMA_Clinic)
I2estimates_Env <- var.comp(OPNMC_MLMA_Env)
I2estimates_Occup <- var.comp(OPNMC_MLMA_Occup)

# Summary table
SubgroupAnalysis_ResultsTable <- data.frame(
    Category = c("Total", 
                 "Class", "Class", "Class",
                 "Exposure Setting", "Exposure Setting",
                 "Recruitment Setting", "Recruitment Setting"),
    Subgroup = c("Total", 
                 "OP only", "NMC only", "OP/NMC",
                 "ExpSet-Env", "ExpSet-Occup",
                 "RecruitSet-Pop", "RecruitSet-Clinic"),
    No_StudyPops = (round(c(OPNMC_MLMA$s.nlevels[1],
                            OPNMC_MLMA_OP_Isolated$s.nlevels[1], 
                            OPNMC_MLMA_NMC_Isolated$s.nlevels[1], OPNMC_MLMA_OPandorNMC$s.nlevels[1],
                            OPNMC_MLMA_Env$s.nlevels[1], OPNMC_MLMA_Occup$s.nlevels[1],
                            OPNMC_MLMA_Pop$s.nlevels[1], OPNMC_MLMA_Clinic$s.nlevels[1]), digits = 2)),
    No_Effects = (round(c(OPNMC_MLMA$s.nlevels[2],
                          OPNMC_MLMA_OP_Isolated$s.nlevels[2],
                          OPNMC_MLMA_NMC_Isolated$s.nlevels[2], OPNMC_MLMA_OPandorNMC$s.nlevels[2],
                          OPNMC_MLMA_Env$s.nlevels[2], OPNMC_MLMA_Occup$s.nlevels[2],
                          OPNMC_MLMA_Pop$s.nlevels[2], OPNMC_MLMA_Clinic$s.nlevels[2]), digits = 2)),
    Estimate = (round(c(OPNMC_MLMA$b,
                        OPNMC_MLMA_OP_Isolated$b,
                        OPNMC_MLMA_NMC_Isolated$b, OPNMC_MLMA_OPandorNMC$b,
                        OPNMC_MLMA_Env$b, OPNMC_MLMA_Occup$b,
                        OPNMC_MLMA_Pop$b, OPNMC_MLMA_Clinic$b), digits = 2)),
    Robust_SE = (round(c(OPNMC_MLMA_robust$SE,
                         OPNMC_MLMA_OP_Isolated_robust$SE,
                         OPNMC_MLMA_NMC_Isolated_robust$SE, 
                         OPNMC_MLMA_OPandorNMC_robust$SE,
                         OPNMC_MLMA_Env_robust$SE, 
                         OPNMC_MLMA_Occup_robust$SE,
                         OPNMC_MLMA_Pop_robust$SE,
                         OPNMC_MLMA_Clinic_robust$SE), digits = 2)),
    Robust_CIL = (round(c(OPNMC_MLMA_robust$CI_L,
                          OPNMC_MLMA_OP_Isolated_robust$CI_L,
                          OPNMC_MLMA_NMC_Isolated_robust$CI_L, 
                          OPNMC_MLMA_OPandorNMC_robust$CI_L,
                          OPNMC_MLMA_Env_robust$CI_L, 
                          OPNMC_MLMA_Occup_robust$CI_L,
                          OPNMC_MLMA_Pop_robust$CI_L,
                          OPNMC_MLMA_Clinic_robust$CI_L), digits = 2)),
    Robust_CIU = (round(c(OPNMC_MLMA_robust$CI_U,
                          OPNMC_MLMA_OP_Isolated_robust$CI_U,
                          OPNMC_MLMA_NMC_Isolated_robust$CI_U, 
                          OPNMC_MLMA_OPandorNMC_robust$CI_U,
                          OPNMC_MLMA_Env_robust$CI_U, 
                          OPNMC_MLMA_Occup_robust$CI_U,
                          OPNMC_MLMA_Pop_robust$CI_U,
                          OPNMC_MLMA_Clinic_robust$CI_U), digits = 2)),
    df_Satt = (round(c(OPNMC_MLMA_robust$df,
                       OPNMC_MLMA_OP_Isolated_robust$df,
                       OPNMC_MLMA_NMC_Isolated_robust$df, 
                       OPNMC_MLMA_OPandorNMC_robust$df,  
                       OPNMC_MLMA_Env_robust$df, 
                       OPNMC_MLMA_Occup_robust$df,
                       OPNMC_MLMA_Pop_robust$df,
                       OPNMC_MLMA_Clinic_robust$df), digits = 2)),
    p_Satt = (round(c(OPNMC_MLMA_robust$p_Satt,
                      OPNMC_MLMA_OP_Isolated_robust$p_Satt,
                      OPNMC_MLMA_NMC_Isolated_robust$p_Satt, 
                      OPNMC_MLMA_OPandorNMC_robust$p_Satt,
                      OPNMC_MLMA_Env_robust$p_Satt, 
                      OPNMC_MLMA_Occup_robust$p_Satt,
                      OPNMC_MLMA_Pop_robust$p_Satt,
                      OPNMC_MLMA_Clinic_robust$p_Satt), digits = 2)),
    BtwStudyPop_T2 = (round(c(OPNMC_MLMA$sigma2[1],
                              OPNMC_MLMA_OP_Isolated$sigma2[1], 
                              OPNMC_MLMA_NMC_Isolated$sigma2[1], OPNMC_MLMA_OPandorNMC$sigma2[1],
                              OPNMC_MLMA_Env$sigma2[1], OPNMC_MLMA_Occup$sigma2[1],
                              OPNMC_MLMA_Pop$sigma2[1], OPNMC_MLMA_Clinic$sigma2[1]), digits = 2)),
    BtwStudyPop_I2 = (round(c(I2estimates_OPNMC$results$`% of total variance`[3],
                              I2estimates_OP_Isolated$results$`% of total variance`[3], 
                              I2estimates_NMC_Isolated$results$`% of total variance`[3],
                              I2estimates_OPandorNMC$results$`% of total variance`[3],
                              I2estimates_Env$results$`% of total variance`[3],
                              I2estimates_Occup$results$`% of total variance`[3],
                              I2estimates_Pop$results$`% of total variance`[3],
                              I2estimates_Clinic$results$`% of total variance`[3]), 
                              digits = 2)),
    WinStudyPop_T2 = (round(c(OPNMC_MLMA$sigma2[2],
                              OPNMC_MLMA_OP_Isolated$sigma2[2], 
                              OPNMC_MLMA_NMC_Isolated$sigma2[2],
                              OPNMC_MLMA_OPandorNMC$sigma2[2],
                              OPNMC_MLMA_Env$sigma2[2], OPNMC_MLMA_Occup$sigma2[2],
                              OPNMC_MLMA_Pop$sigma2[2], OPNMC_MLMA_Clinic$sigma2[2]), digits = 2)),
    WinStudyPop_I2 = (round(c(I2estimates_OPNMC$results$`% of total variance`[2],
                              I2estimates_OP_Isolated$results$`% of total variance`[2], 
                              I2estimates_NMC_Isolated$results$`% of total variance`[2], 
                              I2estimates_OPandorNMC$results$`% of total variance`[2],
                              I2estimates_Env$results$`% of total variance`[2],
                              I2estimates_Occup$results$`% of total variance`[2],
                              I2estimates_Pop$results$`% of total variance`[2],
                              I2estimates_Clinic$results$`% of total variance`[2]), 
                              digits = 2)),
    P_Heterog = (round(c(OPNMC_MLMA$QEp, 
                         OPNMC_MLMA_OP_Isolated$QEp,
                         OPNMC_MLMA_NMC_Isolated$QEp, OPNMC_MLMA_OPandorNMC$QEp,
                         OPNMC_MLMA_Env$QEp, OPNMC_MLMA_Occup$QEp,
                         OPNMC_MLMA_Pop$QEp, OPNMC_MLMA_Clinic$QEp), digits = 2)))

SubgroupAnalysis_ResultsTable
```

There was not enough power to statistically compare differences in the pooled effect estimates of any of the examined subgroups (df_Satt < 4).

### 4. Additional secondary meta-analyses

Note: Two additional analyses were performed in response to comments received during peer-review.

#### a) Continent subgroup analysis

```{r}
## Asia
OPNMC_MLMA_Asia <- rma.mv(yi = Gi,
                            V = OPNMC_Vmatrix_0.8, 
                            data = OPNMC_Data_HedgesG,
                            random = ~ 1 | StudyPop_ID/ES_ID,
                            subset = (Region == "Asia"))

OPNMC_MLMA_Asia_robust_SE <- coef_test(OPNMC_MLMA_Asia, vcov = "CR2")
OPNMC_MLMA_Asia_robust_CI <- conf_int(OPNMC_MLMA_Asia, vcov = "CR2")
OPNMC_MLMA_Asia_robust <- full_join(OPNMC_MLMA_Asia_robust_SE, OPNMC_MLMA_Asia_robust_CI)

## Europe
OPNMC_MLMA_Europe <- rma.mv(yi = Gi,
                            V = OPNMC_Vmatrix_0.8, 
                            data = OPNMC_Data_HedgesG,
                            random = ~ 1 | StudyPop_ID/ES_ID,
                            subset = (Region == "Europe"))

OPNMC_MLMA_Europe_robust_SE <- coef_test(OPNMC_MLMA_Europe, vcov = "CR2")
OPNMC_MLMA_Europe_robust_CI <- conf_int(OPNMC_MLMA_Europe, vcov = "CR2")
OPNMC_MLMA_Europe_robust <- full_join(OPNMC_MLMA_Europe_robust_SE, OPNMC_MLMA_Europe_robust_CI)

## North America
OPNMC_MLMA_NAmer <- rma.mv(yi = Gi,
                            V = OPNMC_Vmatrix_0.8, 
                            data = OPNMC_Data_HedgesG,
                            random = ~ 1 | StudyPop_ID/ES_ID,
                            subset = (Region == "North America"))

OPNMC_MLMA_NAmer_robust_SE <- coef_test(OPNMC_MLMA_NAmer, vcov = "CR2")
OPNMC_MLMA_NAmer_robust_CI <- conf_int(OPNMC_MLMA_NAmer, vcov = "CR2")
OPNMC_MLMA_NAmer_robust <- full_join(OPNMC_MLMA_NAmer_robust_SE, OPNMC_MLMA_NAmer_robust_CI)

## South America
OPNMC_MLMA_SAmer <- rma.mv(yi = Gi,
                            V = OPNMC_Vmatrix_0.8, 
                            data = OPNMC_Data_HedgesG,
                            random = ~ 1 | StudyPop_ID/ES_ID,
                            subset = (Region == "South America"))

OPNMC_MLMA_SAmer_robust_SE <- coef_test(OPNMC_MLMA_SAmer, vcov = "CR2")
OPNMC_MLMA_SAmer_robust_CI <- conf_int(OPNMC_MLMA_SAmer, vcov = "CR2")
OPNMC_MLMA_SAmer_robust <- full_join(OPNMC_MLMA_SAmer_robust_SE, OPNMC_MLMA_SAmer_robust_CI)

## Middle East (only one study)

### Calculate I2 stats ###
I2estimates_Asia <- var.comp(x = OPNMC_MLMA_Asia)
I2estimates_Europe <- var.comp(x = OPNMC_MLMA_Europe)
I2estimates_NAmer <- var.comp(x = OPNMC_MLMA_NAmer)
I2estimates_SAmer <- var.comp(x = OPNMC_MLMA_SAmer)

# Summary table
OPNMCData_Region_ResultsTable <- data.frame(
    Category = c("Total", "Asia", "Europe", "North America", "South America"),
    No_StudyPops = (round(c(OPNMC_MLMA$s.nlevels[1], OPNMC_MLMA_Asia$s.nlevels[1],
                          OPNMC_MLMA_Europe$s.nlevels[1], OPNMC_MLMA_NAmer$s.nlevels[1], 
                          OPNMC_MLMA_SAmer$s.nlevels[1]), digits = 2)),
    No_Effects = (round(c(OPNMC_MLMA$s.nlevels[2], OPNMC_MLMA_Asia$s.nlevels[2],
                          OPNMC_MLMA_Europe$s.nlevels[2], OPNMC_MLMA_NAmer$s.nlevels[2], 
                          OPNMC_MLMA_SAmer$s.nlevels[2]), digits = 2)),
    Estimate = (round(c(OPNMC_MLMA$b, OPNMC_MLMA_Asia$b, 
                        OPNMC_MLMA_Europe$b, OPNMC_MLMA_NAmer$b, 
                        OPNMC_MLMA_SAmer$b), digits = 2)),
    Robust_SE = (round(c(OPNMC_MLMA_robust$SE, 
                         OPNMC_MLMA_Asia_robust$SE,
                         OPNMC_MLMA_Europe_robust$SE, 
                         OPNMC_MLMA_NAmer_robust$SE,
                         OPNMC_MLMA_SAmer_robust$SE), digits = 2)),
    Robust_CIL = (round(c(OPNMC_MLMA_robust$CI_L,
                          OPNMC_MLMA_Asia_robust$CI_L, 
                          OPNMC_MLMA_Europe_robust$CI_L,
                          OPNMC_MLMA_NAmer_robust$CI_L,
                          OPNMC_MLMA_SAmer_robust$CI_L), digits = 2)),
    Robust_CIU = (round(c(OPNMC_MLMA_robust$CI_U,
                          OPNMC_MLMA_Asia_robust$CI_U,
                          OPNMC_MLMA_Europe_robust$CI_U, 
                          OPNMC_MLMA_NAmer_robust$CI_U,
                          OPNMC_MLMA_SAmer_robust$CI_U), digits = 2)),
    df_Satt = (round(c(OPNMC_MLMA_robust$df,
                         OPNMC_MLMA_Asia_robust$df,
                         OPNMC_MLMA_Europe_robust$df, 
                         OPNMC_MLMA_NAmer_robust$df,
                       OPNMC_MLMA_SAmer_robust$df), digits = 2)),
    p_Satt = (round(c(OPNMC_MLMA_robust$p_Satt,
                      OPNMC_MLMA_Asia_robust$p_Satt,
                      OPNMC_MLMA_Europe_robust$p_Satt, 
                      OPNMC_MLMA_NAmer_robust$p_Satt,
                      OPNMC_MLMA_SAmer_robust$p_Satt), digits = 2)),
    BtwStudyPop_T2 = (round(c(OPNMC_MLMA$sigma2[1], OPNMC_MLMA_Asia$sigma2[1],
                          OPNMC_MLMA_Europe$sigma2[1], OPNMC_MLMA_NAmer$sigma2[1],
                          OPNMC_MLMA_SAmer$sigma2[1]), digits = 2)),
    BtwStudyPop_I2 = (round(c(I2estimates_OPNMC$results$`% of total variance`[3],
                          I2estimates_Asia$results$`% of total variance`[3],
                          I2estimates_Europe$results$`% of total variance`[3],
                          I2estimates_NAmer$results$`% of total variance`[3],
                          I2estimates_SAmer$results$`% of total variance`[3]), 
                        digits = 2)),
    WinStudyPop_T2 = (round(c(OPNMC_MLMA$sigma2[2], OPNMC_MLMA_Asia$sigma2[2],
                          OPNMC_MLMA_Europe$sigma2[2], OPNMC_MLMA_NAmer$sigma2[2],
                          OPNMC_MLMA_SAmer$sigma2[2]), digits = 2)),
    WinStudyPop_I2 = (round(c(I2estimates_OPNMC$results$`% of total variance`[2],
                          I2estimates_Asia$results$`% of total variance`[2],
                          I2estimates_Europe$results$`% of total variance`[2],
                          I2estimates_NAmer$results$`% of total variance`[2],
                          I2estimates_SAmer$results$`% of total variance`[2]), 
                        digits = 2)),
    P_Heterog = (round(c(OPNMC_MLMA$QEp, OPNMC_MLMA_Asia$QEp, 
                         OPNMC_MLMA_Europe$QEp, OPNMC_MLMA_NAmer$QEp,
                         OPNMC_MLMA_SAmer$QEp), digits = 2))
  )

OPNMCData_Region_ResultsTable
```

#### b) Confounding and effect modification sensitivity analysis

```{r}
# Controlled for confounding bias and all effect modifications
OPNMC_MLMA_ConfEMLow <- rma.mv(yi = Gi,
                               V = OPNMC_Vmatrix_0.8, 
                               data = OPNMC_Data_HedgesG,
                               random = ~ 1 | StudyPop_ID/ES_ID,
                               subset = ((C_Bias == "Low") & (CoExp_Present != 1) & 
                                           (AbsTime_Controlled == 1) & (MedRiskFactor_Controlled == 1)))

OPNMC_MLMA_ConfEMLow_robustSE <- coef_test(OPNMC_MLMA_ConfEMLow, vcov = "CR2")
OPNMC_MLMA_ConfEMLow_robustCI <- conf_int(OPNMC_MLMA_ConfEMLow, vcov = "CR2")
OPNMC_MLMA_ConfEMLow_robust <- full_join(OPNMC_MLMA_ConfEMLow_robustSE,
                                         OPNMC_MLMA_ConfEMLow_robustCI)

I2estimates_ConfEMLow <- var.comp(x = OPNMC_MLMA_ConfEMLow)

OPNMC_MLMA_ConfEMLow_robust
```

# V. Forest plot data for export

Note: Exported forest plot data from R and then imported the data into Tableau for visualization. Only included study-specific Hedges' g effect sizes in the forest plot data, not pooled effect estimates.

```{r}
forest_dat_nopooled <- OPNMC_Data_HedgesG %>%
  mutate(
    Gi = round(Gi, digits = 2),
    G_LBi = round((Gi - sqrt(G_Vi) * qnorm(0.975)), digits = 2),
    G_UBi = round((Gi + sqrt(G_Vi) * qnorm(0.975)), digits = 2),
    G_CIi_Range = (G_UBi - G_LBi),
    G_95_CIi = as.character(paste(Gi, "(", G_LBi, ",", G_UBi, ")")),
    Weight = round(OPNMC_MLMA_Weights, digits = 2),
    Weight = paste(Weight, "%")
    ) %>%
  mutate_if(is.numeric, round, digits = 2)

# save as an Excel file
write_xlsx(forest_dat_nopooled,"Ellis-et-al-2023-forest-plot-data.xlsx")
```
